<script>
  const rdfFiles = [
    "5687418.bfWork.nt",
    "5687418.bfInstant.nt",
    "n91107599.skos.nt",
    "n91112667.skos.nt",
    "nr99009111.skos.nt",
    "sh85111437.skos.nt",
    "sh87003329.skos.nt"
  ];

  const select = document.getElementById("fileSelect");
  rdfFiles.forEach(f => {
    const option = document.createElement("option");
    option.value = f;
    option.textContent = f;
    select.appendChild(option);
  });

  select.addEventListener("change", () => loadRDF(select.value));

  function shorten(text) {
    if (text.length > 50) {
      return text.substring(0, 47) + "...";
    }
    return text;
  }

  async function loadRDF(filename) {
    const url = `rdf/${filename}`;
    const raw = await fetch(url).then(res => res.text());

    let triples = [];
    try {
      triples = new N3.Parser().parse(raw);
    } catch (e) {
      console.error("Parser error:", e);
      alert("RDF parse error â€” see console");
      return;
    }

    const nodes = {};
    const edges = [];

    triples.forEach(t => {
      const subj = t.subject;
      const obj = t.object;
      const pred = t.predicate;

      // Create unique node IDs
      if (!nodes[subj]) {
        nodes[subj] = { id: subj, label: shorten(subj) };
      }

      if (!nodes[obj]) {
        nodes[obj] = {
          id: obj,
          label: shorten(obj),
          shape: obj.startsWith('"') ? "box" : "ellipse",
          color: obj.startsWith('"') ? "#eef" : undefined
        };
      }

      edges.push({
        from: subj,
        to: obj,
        label: shorten(pred)
      });
    });

    const container = document.getElementById("network");
    const network = new vis.Network(
      container,
      {
        nodes: new vis.DataSet(Object.values(nodes)),
        edges: new vis.DataSet(edges)
      },
      {
        edges: {
          arrows: "to",
          font: { align: "top" }
        },
        physics: { stabilization: true }
      }
    );
  }

  loadRDF(rdfFiles[0]);
</script>
